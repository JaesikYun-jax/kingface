# 사주 & 타로 & 관상 AI 운세 서비스

사주, 타로, 관상을 접목시킨 AI 기반 운세 서비스입니다. 사용자의 생년월일시(사주) 정보를 입력받아 운세를 제공하고, 타로 카드를 선택하거나 얼굴 사진을 분석하여 더 깊은 운세 분석을 제공합니다.

## 서비스 플랜

- **무료 서비스**: 사주 정보(생년월일시)에 기반한 기본 운세 제공
- **프리미엄 서비스**: 사주 기반 운세, 타로 카드 분석, 얼굴 사진 분석(관상)을 모두 제공

## 🧪 프롬프트 테스트 프로세스

### 운세 프롬프트 테스트

코드 변경 후 운세 품질을 확인하기 위한 테스트 도구가 제공됩니다.

#### 테스트 실행 방법:

1. **테스트 파일 열기**
   ```bash
   open src/test/fortune-test.html
   ```
   
2. **API 키 입력**
   - OpenAI API 키를 테스트 페이지에 입력

3. **테스트 데이터 확인**
   - 자동 생성된 사주 정보 확인
   - 타로 카드 정보 수정 (필요시)

4. **테스트 실행**
   - "🔮 운세 테스트 실행" 버튼 클릭
   - 결과 확인 및 품질 검증

#### 자동 검증 항목:

- ✅ 마크다운 헤더 사용 (`## ✨ 전체 운세` 등)
- ✅ 신비로운 첫 문장으로 시작
- ✅ 적절한 분량 (500-2000자)
- ✅ 사주 정보 반영
- ✅ 타로 카드 내용 반영

#### 수동 검증 체크리스트:

1. **캐릭터 일관성**: '아이보살' 캐릭터가 잘 드러나는가?
2. **톤앤매너**: 신비로우면서도 따뜻한 톤인가?
3. **정보 반영**: 입력한 사주/타로 정보가 적절히 활용되었는가?
4. **섹션 구성**: 5개 섹션이 모두 의미있는 내용으로 구성되었는가?
5. **분량 균형**: 각 섹션이 200-300자 정도로 균형있게 작성되었는가?

### Git 커밋 전 확인사항

```bash
# 1. 테스트 실행
open src/test/fortune-test.html

# 2. 최소 3회 테스트 및 결과 확인
# 3. 모든 자동 검증 항목 통과 확인
# 4. 수동 체크리스트 확인

# 5. 테스트 통과 후 커밋
git add .
git commit -m "프롬프트 개선 및 품질 검증 완료"
git push
```

## 주요 기능

- 사주 정보(생년월일시) 입력으로 기본 운세 생성
- 직관에 따른 타로 카드 선택으로 심층 운세 분석
- 얼굴 사진 업로드 또는 카메라로 촬영 후 AI 관상 분석
- 전체, 사랑, 직업, 건강 영역별 운세 제공
- 반응형 UI 지원
- 관리자 페이지를 통한 AI 프롬프트 관리
- 무료/프리미엄 서비스 플랜 선택 기능
- **NEW** 향상된 얼굴 이미지 캡처 기능 (확대/축소 및 위치 조정 지원)
- **NEW** 직관적인 결과 공유 기능 (클립보드 복사 및 텍스트 공유)
- **NEW** 이미지 캡처에 최적화된 UI로 보다 정확한 관상 분석 지원
- **NEW** GPT-4.1-turbo 모델 기반 관상 분석 (기존 GPT-4o 대비 품질 향상)

## 기술 스택

- React.js 18
- TypeScript
- React Router
- Emotion (styled-components)
- React Webcam
- OpenAI API (GPT-3.5-Turbo/GPT-4o/GPT-4.1-turbo 지원)
- 반응형 웹 디자인

## 실행 방법

### 환경 변수 설정

프로젝트 루트에 `.env` 파일을 생성하고 다음과 같이 설정합니다:

```
REACT_APP_OPENAI_API_KEY=여기에_당신의_OpenAI_API_키를_입력하세요
```

### 설치 및 실행

```bash
# 의존성 설치
npm install

# 개발 서버 실행 (자동으로 브라우저가 열립니다)
npm run dev
또는
npm start

# 배포용 빌드
npm run build
```

## 프로젝트 구조

```
src/
├── assets/         # 이미지 및 데이터 파일
│   ├── BirthForm.tsx              # 생년월일 입력 폼
│   ├── FaceCapture.tsx            # 얼굴 촬영 컴포넌트
│   ├── FaceReadingResult.tsx      # 관상 분석 결과 컴포넌트
│   ├── FortuneResult.tsx          # 운세 결과 컴포넌트
│   ├── PlanSelector.tsx           # 서비스 플랜 선택 컴포넌트
│   ├── TarotCardSelector.tsx      # 타로 카드 선택 컴포넌트
│   └── TarotSelection.tsx         # 타로 선택 컴포넌트
├── pages/          # 페이지 컴포넌트
│   ├── AdminPage.tsx              # 관리자 페이지
│   ├── FaceReadingPage.tsx        # 관상 분석 페이지
│   ├── FortunePage.tsx            # 운세 페이지
│   └── HomePage.tsx               # 홈페이지
├── services/       # API 서비스
│   └── api.ts                     # OpenAI API 연동 서비스
├── types/          # TypeScript 타입 정의
│   └── index.ts                   # 공통 타입 정의
└── App.tsx                        # 앱 메인 컴포넌트
```

## 사용 방법

1. 홈페이지에서 서비스 플랜(무료/프리미엄)을 선택합니다.
2. 무료 서비스: 생년월일과 시간을 입력하여 기본적인 운세를 확인합니다.
3. 프리미엄 서비스:
   - 생년월일 기반 운세 확인
   - 타로 카드 중 하나를 직관에 따라 선택하여 심층 분석
   - 얼굴 사진을 업로드하거나 카메라로 촬영하여 관상 분석
     - **NEW** 이미지 확대/축소 및 위치 조정으로 최적의 얼굴 캡처 가능
     - **NEW** 관상 분석 시 자동으로 적절한 이미지 크기로 조정됨
4. AI가 생성한 당신만의 개인화된 운세와 분석 결과를 확인합니다.
   - **NEW** 분석 결과를 클립보드에 복사하여 쉽게 공유할 수 있음
   - **NEW** 간결하고 직관적인 UI로 분석 결과 확인 가능

## 관리자 기능

- 홈페이지 하단의 'Admin' 링크를 통해 관리자 페이지에 접근
- 운세 생성 및 관상 분석에 사용되는 AI 프롬프트 수정
- 무료/프리미엄 서비스에 사용할 OpenAI 모델 설정 (GPT-3.5-Turbo/GPT-4o/GPT-4.1-turbo)

## 최근 업데이트 내역

### 1. 이미지 캡처 기능 개선
- 이미지 드래그를 통한 위치 조정 기능 추가
- 슬라이더를 이용한 확대/축소 기능 추가
- 이미지 로드 시 자동 초기 스케일 계산 적용

### 2. 관상 분석 결과 UI 개선
- 사용자 이미지를 결과 페이지 상단에 원형으로 표시
- "아이보살의 관상 분석 결과" 제목 추가
- 파싱 데이터 섹션 제거 및 원본 마크다운 콘텐츠만 표시
- 결과 복사 기능 개선 (홍보 문구 자동 추가)

### 3. AI 모델 및 프롬프트 개선
- GPT-4o에서 GPT-4.1-turbo 모델로 업그레이드
- 프롬프트 강화로 거부 응답 최소화
- 분석 품질 향상을 위한 온도 매개변수 조정

### 4. 사용자 경험 개선
- 로딩 애니메이션 및 위트 있는 메시지 개선
- 관상 분석 결과에 대한 보다 창의적인 해석 제공
- 공유 기능 개선으로 분석 결과와 홍보 링크 함께 공유

## 주의사항

- 이 서비스는 오락 목적으로 제공되며, 실제 운세 결과와 다를 수 있습니다.
- 관상 분석에 사용된 사진은 서버에 저장되지 않고 분석 후 즉시 폐기됩니다.
- OpenAI API 키는 실제 배포 환경에서는 백엔드를 통해 안전하게 관리해야 합니다.
- 현재 버전은 프론트엔드만 구현된 POC(Proof of Concept) 버전으로, 실제 결제 처리는 구현되어 있지 않습니다.

## 개발 참고사항 및 트러블슈팅

### 1. React 버전 호환성 이슈

- **문제**: 초기에 React 19.1.0을 사용했으나 빌드 환경에서 호환성 문제 발생
- **해결**: React 18.2.0 (안정 버전)으로 다운그레이드
- **참고**: React 19는 2024년 5월 기준 실험적 버전으로, CI/CD 환경 및 Cloudflare Pages와 호환성 문제가 있음
- **조치사항**: package.json의 React 관련 모든 패키지 버전을 18.x로 유지

### 2. Node.js 버전 제한

- **설정**: package.json에 `"engines": { "node": ">=18.0.0 <19.0.0" }` 추가
- **목적**: GitHub Actions 및 Cloudflare Pages에서 안정적인 Node.js LTS 버전 사용 보장
- **참고**: 로컬 개발 환경과 배포 환경의 Node.js 버전 차이로 인한 문제 방지

### 3. GitHub Actions 워크플로우 설정

- **파일위치**: `.github/workflows/main.yml`
- **주요 설정**:
  - Node.js 18.x 버전 사용
  - `actions/checkout@v4`, `actions/setup-node@v4`, `actions/upload-artifact@v4` 최신 버전 사용
  - `CI=false npm run build`: 빌드 시 경고를 오류로 처리하지 않도록 설정
- **문제해결**: GitHub Actions에서 발생하는 "missing download info" 오류는 actions 버전을 v4로 업데이트하여 해결

### 4. API 키 보안

- **문제**: GitHub 저장소에 실제 OpenAI API 키가 노출되는 문제
- **해결**: 
  - `.gitignore`에 `.env` 파일 추가
  - GitHub Actions 워크플로우에서 빌드 시 더미 환경 변수 생성
  - 실제 환경 변수는 Cloudflare Pages 설정에서 별도 관리
- **권장사항**: API 키는 항상 환경 변수로 관리하고, 소스 코드에 직접 포함하지 않음

### 5. OpenAI 모델 설정

- **사용 모델**: 
  - 일반 운세: 경제적인 `gpt-3.5-turbo` 모델 사용
  - 관상 분석: 이미지 처리 가능한 `gpt-4.1-turbo` 모델 사용 (기존 `gpt-4o`에서 업그레이드)
- **참고**: OpenAI 모델은 지속적으로 업데이트되므로, API 응답에서 발생하는 오류 확인 필요
- **대체 방안**: 관상 분석에서 `gpt-4.1-turbo`가 지원되지 않을 경우, `gpt-4-turbo`로 폴백하는 로직 구현

### 6. Cloudflare Pages 배포 설정

- **빌드 명령어**: `CI=false npm run build`
- **환경 변수**: 
  - `REACT_APP_OPENAI_API_KEY`: OpenAI API 키 (Cloudflare Pages 환경 변수에 설정)
  - `NODE_VERSION`: 18 (Node.js 버전 명시)
- **주의사항**: 배포 후 처음 몇 분간 사이트가 느리게 로드될 수 있음 (Cloudflare 캐시 워밍업 중)

### 7. 관상 분석 기능 최적화

- **문제**: 초기에 관상 분석 API 요청 시 반복적인 거부 응답 발생
- **해결**:
  - 프롬프트 수정: 엔터테인먼트 목적임을 강조하는 내용 추가
  - 모델 변경: `gpt-4o`에서 `gpt-4.1-turbo`로 업그레이드
  - 매개변수 조정: 온도 값을 0.8에서 0.6으로 조정하여 일관성 향상
- **결과**: 관상 분석 거부 응답 발생 빈도 크게 감소

### 8. 이미지 캡처 및 처리 개선

- **문제**: 관상 분석을 위한 이미지 캡처 시 확대/축소 및 위치 조정 필요
- **해결**:
  - 드래그로 이미지 위치를 조정할 수 있는 기능 구현
  - 슬라이더로 확대/축소 제어 기능 추가
  - Canvas를 활용한 고품질 이미지 추출 로직 구현 (JPEG 95% 품질)
- **향상점**: 이미지 로드 시 자동으로 적절한 초기 크기 계산 적용

## 라이선스

MIT
